# Plugin Resolution Process

## Overview
The Skyrim Plugin Parser uses two key files to determine which plugins to process and in what order:
1. `plugins.txt` - Defines the load order of plugins
2. `modlist.txt` - Defines the list of installed mods

## File Formats

### plugins.txt
This file is typically located in the Skyrim data directory and contains:
- One plugin name per line
- Optional `*` prefix to indicate the plugin is active
- Comments starting with `#` are ignored
- Empty lines are ignored

Example:
```
*Skyrim.esm
*Update.esm
*Dawnguard.esm
*HearthFires.esm
*Dragonborn.esm
*Requiem.esp
```

### modlist.txt
This file is typically generated by mod managers and contains:
- One mod name per line
- Optional `+` prefix to indicate the mod is active
- Mod names match the folder names in the extracted directory
- Comments starting with `#` are ignored
- Empty lines are ignored

Example:
```
+Skyrim
+Update
+Dawnguard
+HearthFires
+Dragonborn
+Requiem
```

## Resolution Process

1. **Initial Validation**
   - Verify that both `modlist.txt` and `plugins.txt` exist in the mod directory
   - Throw error if either file is missing

2. **Load Order Determination**
   - Read `plugins.txt` to get the list of enabled plugins
   - Only plugins with `*` prefix are considered
   - Strip `*` prefix from plugin names
   - Store the index for each plugin to maintain load order

3. **Mod List Processing**
   - Read `modlist.txt` to get the list of active mods
   - Only mods with `+` prefix are considered
   - Strip `+` prefix from mod names

4. **Plugin File Location**
   - For each active mod in `modlist.txt`:
     - Look for plugin files (`.esp` or `.esm`) in the mod's directory
     - For each plugin file found:
       - Check if it's in the enabled plugins list
       - If enabled, add to the final plugin list with metadata
   - Skip mods that can't be read (with warning)
   - Throw error if no valid plugins are found

## Directory Structure
```
modDirPath/
├── modlist.txt
├── plugins.txt
├── Skyrim/
│   └── Skyrim.esm
├── Update/
│   └── Update.esm
├── Dawnguard/
│   └── Dawnguard.esm
└── Requiem/
    └── Requiem.esp
```

## Error Handling

### Missing Files
If required files are missing:
- An error is thrown immediately
- The process is terminated
- A helpful error message is displayed

### Missing Plugins
If a plugin file can't be found:
- A warning is logged with the expected path
- The plugin is skipped
- Processing continues with remaining plugins

### No Valid Plugins
If no valid plugins are found:
- An error is thrown
- The process is terminated
- A helpful error message is displayed with:
  - List of mods checked
  - List of enabled plugins

## Configuration
The plugin resolution process is configured through:
- `modDirPath`: Base directory containing mod folders and configuration files

Example config:
```json
{
  "modDirPath": "./data/mod-samples",
  "outputPath": "./output",
  "maxThreads": 4,
  "recordTypeFilter": ["PERK", "RACE"]
}
``` 