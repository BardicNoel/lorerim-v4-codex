# Plugin Resolution Process

## Overview
The Skyrim Plugin Parser uses two key files to determine which plugins to process and in what order:
1. `plugins.txt` - Defines the load order of plugins
2. `modlist.txt` - Defines the list of installed mods

## File Formats

### plugins.txt
This file is typically located in the Skyrim data directory and contains:
- One plugin name per line
- Optional `*` prefix to indicate the plugin is active
- Comments starting with `#` are ignored
- Empty lines are ignored

Example:
```
*Skyrim.esm
*Update.esm
*Dawnguard.esm
*HearthFires.esm
*Dragonborn.esm
*Requiem.esp
```

### modlist.txt
This file is typically generated by mod managers and contains:
- One mod name per line
- Mod names match the folder names in the extracted directory
- Comments starting with `#` are ignored
- Empty lines are ignored

Example:
```
Skyrim
Update
Dawnguard
HearthFires
Dragonborn
Requiem
```

## Resolution Process

1. **Load Order Determination**
   - Read `plugins.txt` to get the list of plugins in load order
   - Strip `*` prefix from plugin names if present
   - Store the index for each plugin to maintain load order

2. **Plugin File Location**
   - For each plugin in `plugins.txt`:
     - Extract the base name (without extension)
     - Look for a matching folder in the extracted directory
     - Look for the plugin file inside that folder
     - Example: `Requiem.esp` → `extracted/Requiem/Requiem.esp`

3. **Validation**
   - Verify each plugin file exists
   - Verify the plugin file is readable
   - Skip plugins that can't be found (with warning)
   - Throw error if no valid plugins are found

## Directory Structure
```
extracted/
├── Skyrim/
│   └── Skyrim.esm
├── Update/
│   └── Update.esm
├── Dawnguard/
│   └── Dawnguard.esm
└── Requiem/
    └── Requiem.esp
```

## Error Handling

### Missing Plugins
If a plugin file can't be found:
- A warning is logged with the expected path
- The plugin is skipped
- Processing continues with remaining plugins

### No Valid Plugins
If no valid plugins are found:
- An error is thrown
- The process is terminated
- A helpful error message is displayed

## Configuration
The plugin resolution process is configured through:
- `extractedDir`: Base directory containing mod folders
- `pluginsTxtPath`: Path to the plugins.txt file

Example config:
```json
{
  "extractedDir": "../data/mod-samples",
  "pluginsTxtPath": "../data/mod-samples/plugins.txt",
  "outputDir": "../output/skyrim-extractor/mod-samples",
  "maxThreads": 4
}
``` 